#!/usr/bin/env bash

mkdir -p .

if ! command -v gdalinfo &> /dev/null
then
  echo "Error: gdalinfo could not be found. Please install GDAL."
  exit 1
fi
if ! command -v gdalbuildvrt &> /dev/null
then
  echo "Error: gdalbuildvrt could not be found. Please install GDAL."
  exit 1
fi
if ! command -v gdal_translate &> /dev/null
then
  echo "Error: gdal_translate could not be found. Please install GDAL."
  exit 1
fi
if ! command -v gdalwarp &> /dev/null
then
  echo "Error: gdalwarp could not be found. Please install GDAL."
  exit 1
fi
if ! command -v jq &> /dev/null
then
  echo "Error: jq could not be found. Please install jq: https://jqlang.github.io/jq/."
  exit 1
fi

if ! [ -f ./bc5d7040bad8e28b.jpg ]; then
  echo "Image file does not exist: ./bc5d7040bad8e28b.jpg"
  echo "This script expects a full-size source images for each georeferenced map it processes. See the README for more information."
  exit 1
fi

required_width_bc5d7040bad8e28b_5cf13f6681d355e3=5240
required_height_bc5d7040bad8e28b_5cf13f6681d355e3=3994

width_bc5d7040bad8e28b_5cf13f6681d355e3=( $(gdalinfo -json ./bc5d7040bad8e28b.jpg | jq '.size[0]') )
height_bc5d7040bad8e28b_5cf13f6681d355e3=( $(gdalinfo -json ./bc5d7040bad8e28b.jpg | jq '.size[1]') )

if [ "$width_bc5d7040bad8e28b_5cf13f6681d355e3" -eq "$required_width_bc5d7040bad8e28b_5cf13f6681d355e3" ] &&
   [ "$height_bc5d7040bad8e28b_5cf13f6681d355e3" -eq "$required_height_bc5d7040bad8e28b_5cf13f6681d355e3" ]; then
    echo "Found image with correct size: ./bc5d7040bad8e28b.jpg"
else
    echo "Error: found image with incorrect size"
    echo "  Image: ./bc5d7040bad8e28b.jpg"
    echo "  Expected: $required_width_bc5d7040bad8e28b_5cf13f6681d355e3 x $required_height_bc5d7040bad8e28b_5cf13f6681d355e3"
    echo "  Found: $width_bc5d7040bad8e28b_5cf13f6681d355e3 x $height_bc5d7040bad8e28b_5cf13f6681d355e3"
    exit 1
fi
gdal_translate -of vrt \
  -a_srs 'EPSG:3857' \
  -gcp 1801 2421 548613.3751837945 6864617.739664596 \
-gcp 4222 1445 546926.5398078549 6863398.238686091 \
-gcp 1146 1267 549383.7060600839 6863825.8467286 \
  ./bc5d7040bad8e28b.jpg \
  ./bc5d7040bad8e28b_5cf13f6681d355e3.vrt

echo '{"type":"Polygon","coordinates":[[[4.942014983095043,52.34722138206175],[4.941913236710654,52.34745322244565],[4.9418114903262635,52.3476850616137],[4.941709743941875,52.347916899565895],[4.941607997557485,52.34814873630226],[4.941506251173095,52.34838057182277],[4.9414045047887045,52.34861240612744],[4.941302758404314,52.34884423921628],[4.941201012019925,52.34907607108928],[4.941099265635536,52.349307901746435],[4.940997519251146,52.34953973118777],[4.940895772866757,52.34977155941328],[4.940794026482366,52.350003386422976],[4.940692280097977,52.35023521221682],[4.940590533713587,52.350467036794875],[4.940488787329198,52.35069886015708],[4.940387040944807,52.35093068230349],[4.940285294560418,52.3511625032341],[4.940183548176028,52.351394322948885],[4.940081801791639,52.351626141447866],[4.939980055407248,52.35185795873104],[4.939878309022859,52.35208977479841],[4.93977656263847,52.352321589649975],[4.93967481625408,52.352553403285754],[4.939573069869691,52.352785215705744],[4.939471323485299,52.35301702690993],[4.93936957710091,52.35324883689833],[4.9392678307165205,52.35348064567095],[4.93916608433213,52.35371245322778],[4.939064337947741,52.353944259568834],[4.938962591563352,52.35417606469409],[4.9388608451789615,52.35440786860359],[4.938759098794573,52.35463967129731],[4.938657352410182,52.354871472775265],[4.938555606025793,52.35510327303744],[4.9384538596414025,52.35533507208387],[4.938352113257012,52.35556686991452],[4.938250366872623,52.35579866652941],[4.938148620488233,52.35603046192855],[4.9380468741038435,52.356262256111926],[4.937945127719455,52.356494049079565],[4.937843381335064,52.35672584083143],[4.937741634950675,52.356957631367564],[4.937639888566285,52.357189420687945],[4.937538142181896,52.35742120879258],[4.937436395797505,52.357652995681484],[4.937334649413115,52.35788478135465],[4.937232903028726,52.358116565812075],[4.9371311566443365,52.35834834905378],[4.937029410259946,52.35858013107975],[4.936927663875557,52.35881191188998],[4.936825917491167,52.3590436914845],[4.9367241711067775,52.35927546986329],[4.936622424722389,52.359507247026364],[4.936520678337997,52.35973902297373],[4.936418931953608,52.359970797705365],[4.9363171855692185,52.3602025712213],[4.936215439184828,52.36043434352152],[4.936113692800439,52.36066611460605],[4.936011946416049,52.360897884474866],[4.9359102000316595,52.36112965312797],[4.935808453647271,52.36136142056539],[4.93570670726288,52.36159318678711],[4.935604960878491,52.36182495179313],[4.9355032144941,52.36205671558346],[4.935017045087354,52.361987349377],[4.9345308756806086,52.36191798306164],[4.934044706273861,52.361848616637374],[4.933558536867115,52.36177925010423],[4.933072367460368,52.36170988346217],[4.932586198053621,52.361640516711205],[4.932100028646874,52.36157114985135],[4.931613859240128,52.36150178288259],[4.931127689833382,52.36143241580492],[4.930641520426636,52.36136304861836],[4.930155351019888,52.3612936813229],[4.929669181613142,52.36122431391854],[4.929183012206396,52.36115494640527],[4.928696842799649,52.361085578783104],[4.928210673392903,52.36101621105204],[4.9277245039861555,52.36094684321207],[4.92723833457941,52.3608774752632],[4.926752165172663,52.36080810720543],[4.926265995765917,52.36073873903876],[4.925779826359171,52.36066937076318],[4.925293656952423,52.36060000237872],[4.924807487545676,52.36053063388533],[4.924321318138931,52.36046126528305],[4.923835148732184,52.36039189657187],[4.9233489793254375,52.36032252775179],[4.922862809918692,52.36025315882281],[4.922376640511944,52.36018378978493],[4.921890471105198,52.36011442063813],[4.921404301698452,52.36004505138244],[4.920918132291705,52.359975682017854],[4.920431962884958,52.359906312544354],[4.919945793478213,52.359836942961955],[4.9194596240714645,52.359767573270666],[4.9189734546647195,52.35969820347045],[4.9184872852579735,52.35962883356134],[4.918001115851225,52.35955946354334],[4.917514946444481,52.35949009341643],[4.917028777037733,52.35942072318061],[4.916542607630986,52.359351352835915],[4.91605643822424,52.35928198238229],[4.915570268817494,52.359212611819764],[4.9150840994107465,52.359143241148345],[4.914597930004001,52.359073870368015],[4.914111760597254,52.359004499478786],[4.913625591190508,52.358935128480645],[4.913139421783762,52.358865757373614],[4.912653252377015,52.35879638615767],[4.912167082970268,52.35872701483283],[4.911680913563521,52.358657643399084],[4.911194744156775,52.35858827185643],[4.910708574750028,52.35851890020488],[4.910222405343283,52.35844952844442],[4.909736235936535,52.35838015657506],[4.909250066529789,52.35831078459679],[4.908763897123042,52.35824141250963],[4.908277727716296,52.358172040313555],[4.90779155830955,52.358102668008584],[4.907305388902802,52.358033295594694],[4.906819219496057,52.3579639230719],[4.90633305008931,52.35789455044022],[4.905846880682564,52.35782517769962],[4.905360711275818,52.35775580485012],[4.90487454186907,52.35768643189172],[4.904388372462323,52.35761705882441],[4.904494280131947,52.357385941528015],[4.9046001878015675,52.35715482302289],[4.904706095471189,52.35692370330904],[4.904812003140813,52.356692582386465],[4.9049179108104335,52.35646146025516],[4.905023818480056,52.35623033691511],[4.905129726149679,52.35599921236633],[4.905235633819301,52.355768086608805],[4.905341541488922,52.35553695964255],[4.905447449158546,52.35530583146753],[4.905553356828168,52.35507470208378],[4.905659264497789,52.35484357149127],[4.905765172167412,52.35461243969001],[4.905871079837034,52.354381306680004],[4.905976987506657,52.35415017246123],[4.9060828951762785,52.3539190370337],[4.9061888028459,52.353687900397404],[4.906294710515523,52.35345676255234],[4.9064006181851445,52.35322562349851],[4.906506525854767,52.35299448323591],[4.906612433524389,52.35276334176454],[4.906718341194011,52.35253219908439],[4.906824248863633,52.35230105519547],[4.906930156533256,52.35206991009777],[4.907036064202877,52.35183876379127],[4.9071419718725,52.35160761627599],[4.907247879542122,52.351376467551944],[4.907353787211744,52.351145317619086],[4.907459694881368,52.35091416647744],[4.907565602550989,52.350683014126986],[4.90767151022061,52.350451860567745],[4.907777417890234,52.35022070579971],[4.907883325559855,52.34998954982285],[4.907989233229477,52.349758392637206],[4.9080951408991,52.349527234242736],[4.908201048568722,52.34929607463947],[4.908306956238343,52.34906491382738],[4.908412863907967,52.34883375180647],[4.908518771577588,52.34860258857675],[4.90862467924721,52.3483714241382],[4.908730586916833,52.34814025849083],[4.908836494586455,52.347909091634634],[4.908942402256077,52.34767792356961],[4.909048309925699,52.347446754295746],[4.909154217595321,52.34721558381305],[4.909260125264944,52.34698441212153],[4.909366032934565,52.346753239221165],[4.909471940604188,52.34652206511194],[4.90957784827381,52.34629088979389],[4.9096837559434325,52.34605971326699],[4.909789663613054,52.34582853553124],[4.909895571282677,52.34559735658663],[4.9100014789522985,52.345366176433174],[4.910107386621921,52.34513499507085],[4.910213294291543,52.34490381249968],[4.9103192019611654,52.34467262871963],[4.910425109630788,52.34444144373073],[4.91053101730041,52.344210257532964],[4.9106369249700315,52.34397907012631],[4.910742832639654,52.3437478815108],[4.910848740309276,52.34351669168641],[4.910954647978898,52.34328550065314],[4.91106055564852,52.34305430841099],[4.9111664633181435,52.34282311495996],[4.942014983095043,52.34722138206175]]]}' > ./bc5d7040bad8e28b_5cf13f6681d355e3.geojson

gdalwarp \
  -of COG -co COMPRESS=JPEG -co QUALITY=75 \
  -dstalpha -overwrite \
  -r cubic \
  -cutline ./bc5d7040bad8e28b_5cf13f6681d355e3.geojson -crop_to_cutline -cutline_srs "EPSG:4326" \
  -s_srs 'EPSG:3857' \
  -t_srs 'EPSG:3857' \
  -ts 5143 4304 \
  -order 1 \
  ./bc5d7040bad8e28b_5cf13f6681d355e3.vrt \
  ./bc5d7040bad8e28b_5cf13f6681d355e3-warped.tif
if ! [ -f ./b001de2950590a8d.jpg ]; then
  echo "Image file does not exist: ./b001de2950590a8d.jpg"
  echo "This script expects a full-size source images for each georeferenced map it processes. See the README for more information."
  exit 1
fi

required_width_b001de2950590a8d_83d44a0b956681b0=5208
required_height_b001de2950590a8d_83d44a0b956681b0=3949

width_b001de2950590a8d_83d44a0b956681b0=( $(gdalinfo -json ./b001de2950590a8d.jpg | jq '.size[0]') )
height_b001de2950590a8d_83d44a0b956681b0=( $(gdalinfo -json ./b001de2950590a8d.jpg | jq '.size[1]') )

if [ "$width_b001de2950590a8d_83d44a0b956681b0" -eq "$required_width_b001de2950590a8d_83d44a0b956681b0" ] &&
   [ "$height_b001de2950590a8d_83d44a0b956681b0" -eq "$required_height_b001de2950590a8d_83d44a0b956681b0" ]; then
    echo "Found image with correct size: ./b001de2950590a8d.jpg"
else
    echo "Error: found image with incorrect size"
    echo "  Image: ./b001de2950590a8d.jpg"
    echo "  Expected: $required_width_b001de2950590a8d_83d44a0b956681b0 x $required_height_b001de2950590a8d_83d44a0b956681b0"
    echo "  Found: $width_b001de2950590a8d_83d44a0b956681b0 x $height_b001de2950590a8d_83d44a0b956681b0"
    exit 1
fi
gdal_translate -of vrt \
  -a_srs 'EPSG:3857' \
  -gcp 4346 2550 549983.8183030015 6865114.585151263 \
-gcp 2243 1837 551701.3778583999 6864958.450720401 \
-gcp 3823 1010 550703.9552208921 6864005.396387596 \
  ./b001de2950590a8d.jpg \
  ./b001de2950590a8d_83d44a0b956681b0.vrt

echo '{"type":"Polygon","coordinates":[[[4.970554723563076,52.35232547155536],[4.9704564877819335,52.35255115798297],[4.970358252000793,52.35277684325821],[4.970260016219649,52.35300252738107],[4.970161780438508,52.353228210351574],[4.970063544657365,52.35345389216971],[4.9699653088762235,52.353679572835475],[4.969867073095082,52.35390525234888],[4.969768837313941,52.354130930709935],[4.969670601532798,52.35435660791862],[4.969572365751657,52.35458228397497],[4.969474129970514,52.35480795887896],[4.969375894189373,52.3550336326306],[4.969277658408231,52.35525930522988],[4.969179422627089,52.355484976676834],[4.969081186845947,52.35571064697144],[4.968982951064805,52.355936316113706],[4.9688847152836635,52.35616198410364],[4.968786479502522,52.35638765094124],[4.968688243721379,52.35661331662649],[4.968590007940238,52.35683898115943],[4.968491772159095,52.35706464454004],[4.968393536377954,52.35729030676831],[4.968295300596812,52.35751596784427],[4.96819706481567,52.35774162776791],[4.968098829034528,52.35796728653923],[4.968000593253387,52.35819294415823],[4.967902357472243,52.35841860062492],[4.967804121691102,52.3586442559393],[4.967705885909959,52.35886991010137],[4.9676076501288176,52.359095563111126],[4.967509414347676,52.3593212149686],[4.967411178566535,52.35954686567376],[4.967312942785392,52.35977251522662],[4.967214707004251,52.35999816362718],[4.967116471223108,52.36022381087545],[4.967018235441968,52.36044945697143],[4.966919999660825,52.36067510191512],[4.966821763879683,52.36090074570653],[4.966723528098541,52.361126388345646],[4.9666252923174,52.361352029832474],[4.966527056536258,52.36157767016703],[4.966428820755116,52.361803309349305],[4.966330584973973,52.362028947379315],[4.966232349192832,52.36225458425704],[4.96613411341169,52.362480219982494],[4.966035877630548,52.36270585455569],[4.965937641849406,52.36293148797662],[4.965839406068264,52.36315712024528],[4.965741170287123,52.36338275136168],[4.96564293450598,52.363608381325825],[4.9655446987248375,52.363834010137715],[4.965446462943696,52.36405963779734],[4.965348227162554,52.36428526430473],[4.9652499913814125,52.36451088965987],[4.96515175560027,52.36473651386275],[4.965053519819129,52.36496213691339],[4.964955284037986,52.36518775881179],[4.964857048256845,52.36541337955796],[4.964758812475703,52.36563899915188],[4.964660576694562,52.36586461759357],[4.964562340913419,52.36609023488303],[4.9644641051322775,52.36631585102027],[4.964365869351136,52.36654146600527],[4.964267633569994,52.366767079838034],[4.963815723865529,52.366696693665446],[4.963363814161065,52.366626307380706],[4.962911904456599,52.366555920983814],[4.962459994752133,52.36648553447478],[4.96200808504767,52.36641514785361],[4.961556175343204,52.36634476112028],[4.961104265638739,52.366274374274816],[4.960652355934274,52.36620398731719],[4.960200446229809,52.366133600247444],[4.959748536525344,52.36606321306554],[4.95929662682088,52.36599282577148],[4.958844717116414,52.36592243836528],[4.95839280741195,52.36585205084694],[4.957940897707485,52.36578166321644],[4.957488988003019,52.36571127547381],[4.957037078298556,52.36564088761902],[4.956585168594089,52.36557049965208],[4.956133258889625,52.36550011157302],[4.955681349185159,52.36542972338179],[4.955229439480695,52.365359335078416],[4.954777529776231,52.3652889466629],[4.954325620071765,52.36521855813523],[4.9538737103673,52.36514816949542],[4.953421800662835,52.36507778074347],[4.952969890958371,52.36500739187936],[4.952517981253904,52.36493700290311],[4.952066071549441,52.364866613814705],[4.951614161844975,52.36479622461416],[4.95116225214051,52.36472583530147],[4.950710342436046,52.36465544587663],[4.95025843273158,52.36458505633964],[4.949806523027116,52.364514666690496],[4.94935461332265,52.36444427692921],[4.948902703618185,52.36437388705578],[4.948450793913721,52.3643034970702],[4.947998884209256,52.36423310697248],[4.9475469745047915,52.3641627167626],[4.947095064800325,52.36409232644057],[4.9466431550958605,52.36402193600641],[4.946191245391396,52.36395154546008],[4.945739335686931,52.36388115480161],[4.945287425982466,52.363810764030994],[4.944835516278001,52.36374037314824],[4.9443836065735365,52.36366998215331],[4.943931696869072,52.36359959104626],[4.943479787164607,52.36352919982705],[4.943027877460141,52.363458808495686],[4.942575967755676,52.363388417052185],[4.942124058051211,52.36331802549652],[4.941672148346746,52.36324763382872],[4.941220238642281,52.363177242048764],[4.940768328937817,52.36310685015666],[4.940316419233351,52.36303645815241],[4.939864509528887,52.36296606603601],[4.939412599824422,52.36289567380746],[4.938960690119957,52.36282528146676],[4.938508780415493,52.36275488901391],[4.9380568707110255,52.36268449644891],[4.937604961006562,52.362614103771755],[4.937153051302097,52.36254371098246],[4.936701141597632,52.36247331808101],[4.936249231893168,52.36240292506742],[4.9357973221887015,52.36233253194167],[4.935345412484238,52.36226213870378],[4.935451212673638,52.36203409034807],[4.935557012863041,52.36180604081532],[4.935662813052443,52.36157799010554],[4.935768613241845,52.361349938218716],[4.9358744134312476,52.36112188515485],[4.93598021362065,52.36089383091393],[4.936086013810052,52.36066577549598],[4.936191813999454,52.36043771890098],[4.936297614188856,52.36020966112893],[4.936403414378258,52.35998160217983],[4.936509214567661,52.35975354205366],[4.936615014757063,52.35952548075043],[4.936720814946465,52.359297418270145],[4.936826615135867,52.3590693546128],[4.936932415325269,52.35884128977839],[4.937038215514671,52.35861322376691],[4.937144015704074,52.358385156578336],[4.937249815893476,52.35815708821272],[4.937355616082878,52.35792901867001],[4.937461416272279,52.357700947950235],[4.937567216461682,52.35747287605336],[4.937673016651084,52.357244802979416],[4.937778816840487,52.357016728728375],[4.937884617029889,52.356788653300256],[4.937990417219289,52.356560576695045],[4.938096217408692,52.356332498912735],[4.938202017598095,52.35610441995333],[4.938307817787497,52.355876339816824],[4.9384136179769,52.35564825850323],[4.938519418166301,52.35542017601253],[4.9386252183557025,52.355192092344716],[4.938731018545106,52.3549640074998],[4.938836818734508,52.35473592147777],[4.93894261892391,52.35450783427862],[4.939048419113312,52.354279745902375],[4.939154219302714,52.354051656349],[4.939260019492116,52.353823565618505],[4.939365819681519,52.353595473710875],[4.93947161987092,52.35336738062614],[4.939577420060322,52.35313928636426],[4.939683220249725,52.35291119092527],[4.939789020439127,52.35268309430913],[4.939894820628529,52.35245499651585],[4.940000620817931,52.35222689754546],[4.940106421007333,52.351998797397904],[4.940212221196735,52.35177069607321],[4.940318021386138,52.35154259357138],[4.94042382157554,52.351314489892395],[4.9405296217649415,52.35108638503626],[4.940635421954344,52.35085827900297],[4.940741222143746,52.35063017179254],[4.940847022333148,52.350402063404935],[4.940952822522551,52.350173953840184],[4.941058622711952,52.34994584309827],[4.9411644229013545,52.34971773117918],[4.941270223090757,52.34948961808293],[4.941376023280159,52.34926150380951],[4.941481823469561,52.34903338835892],[4.941587623658963,52.34880527173116],[4.941693423848365,52.34857715392621],[4.9417992240377675,52.348349034944086],[4.94190502422717,52.34812091478478],[4.942010824416572,52.34789279344829],[4.942116624605974,52.347664670934606],[4.970554723563076,52.35232547155536]]]}' > ./b001de2950590a8d_83d44a0b956681b0.geojson

gdalwarp \
  -of COG -co COMPRESS=JPEG -co QUALITY=75 \
  -dstalpha -overwrite \
  -r cubic \
  -cutline ./b001de2950590a8d_83d44a0b956681b0.geojson -crop_to_cutline -cutline_srs "EPSG:4326" \
  -s_srs 'EPSG:3857' \
  -t_srs 'EPSG:3857' \
  -ts 4955 4402 \
  -order 1 \
  ./b001de2950590a8d_83d44a0b956681b0.vrt \
  ./b001de2950590a8d_83d44a0b956681b0-warped.tif
if ! [ -f ./44a2797e3fc5e3cf.jpg ]; then
  echo "Image file does not exist: ./44a2797e3fc5e3cf.jpg"
  echo "This script expects a full-size source images for each georeferenced map it processes. See the README for more information."
  exit 1
fi

required_width_44a2797e3fc5e3cf_3b72f58c723da9c4=5328
required_height_44a2797e3fc5e3cf_3b72f58c723da9c4=4003

width_44a2797e3fc5e3cf_3b72f58c723da9c4=( $(gdalinfo -json ./44a2797e3fc5e3cf.jpg | jq '.size[0]') )
height_44a2797e3fc5e3cf_3b72f58c723da9c4=( $(gdalinfo -json ./44a2797e3fc5e3cf.jpg | jq '.size[1]') )

if [ "$width_44a2797e3fc5e3cf_3b72f58c723da9c4" -eq "$required_width_44a2797e3fc5e3cf_3b72f58c723da9c4" ] &&
   [ "$height_44a2797e3fc5e3cf_3b72f58c723da9c4" -eq "$required_height_44a2797e3fc5e3cf_3b72f58c723da9c4" ]; then
    echo "Found image with correct size: ./44a2797e3fc5e3cf.jpg"
else
    echo "Error: found image with incorrect size"
    echo "  Image: ./44a2797e3fc5e3cf.jpg"
    echo "  Expected: $required_width_44a2797e3fc5e3cf_3b72f58c723da9c4 x $required_height_44a2797e3fc5e3cf_3b72f58c723da9c4"
    echo "  Found: $width_44a2797e3fc5e3cf_3b72f58c723da9c4 x $height_44a2797e3fc5e3cf_3b72f58c723da9c4"
    exit 1
fi
gdal_translate -of vrt \
  -a_srs 'EPSG:3857' \
  -gcp 560 3581 549978.1298770219 6863216.971363358 \
-gcp 2803 2460 548498.1706427726 6861901.91679246 \
-gcp 1009 1245 550155.4284300082 6861373.64125519 \
  ./44a2797e3fc5e3cf.jpg \
  ./44a2797e3fc5e3cf_3b72f58c723da9c4.vrt

echo '{"type":"Polygon","coordinates":[[[4.94796273977978,52.33436547931902],[4.947862036606746,52.33457558143333],[4.94776133343371,52.334785682549544],[4.947660630260677,52.334995782667704],[4.947559927087642,52.3352058817878],[4.947459223914608,52.33541597990982],[4.947358520741574,52.33562607703377],[4.9472578175685396,52.33583617315968],[4.947157114395506,52.336046268287525],[4.94705641122247,52.336256362417295],[4.946955708049437,52.33646645554902],[4.946855004876403,52.33667654768271],[4.9467543017033675,52.33688663881833],[4.946653598530334,52.33709672895589],[4.946552895357299,52.33730681809542],[4.946452192184265,52.3375169062369],[4.946351489011231,52.33772699338032],[4.946250785838196,52.33793707952572],[4.946150082665162,52.33814716467307],[4.946049379492128,52.33835724882239],[4.9459486763190945,52.33856733197366],[4.9458479731460585,52.3387774141269],[4.945747269973024,52.338987495282105],[4.94564656679999,52.339197575439286],[4.945545863626956,52.33940765459844],[4.9454451604539225,52.33961773275956],[4.945344457280888,52.33982780992266],[4.945243754107854,52.34003788608772],[4.945143050934818,52.34024796125479],[4.9450423477617855,52.34045803542382],[4.94494164458875,52.34066810859483],[4.944840941415716,52.34087818076784],[4.944740238242683,52.34108825194283],[4.944639535069648,52.341298322119805],[4.9445388318966135,52.34150839129877],[4.944438128723579,52.34171845947973],[4.944337425550545,52.341928526662684],[4.944236722377511,52.342138592847625],[4.944136019204476,52.34234865803459],[4.944035316031442,52.34255872222354],[4.943934612858407,52.34276878541448],[4.943833909685373,52.34297884760743],[4.943733206512339,52.34318890880239],[4.9436325033393045,52.34339896899936],[4.94353180016627,52.34360902819833],[4.943431096993236,52.34381908639932],[4.943330393820201,52.34402914360233],[4.943229690647167,52.34423919980734],[4.943128987474133,52.344449255014375],[4.943028284301097,52.34465930922343],[4.942927581128064,52.344869362434494],[4.942826877955031,52.3450794146476],[4.942726174781996,52.34528946586272],[4.942625471608962,52.34549951607987],[4.942524768435926,52.345709565299046],[4.942424065262894,52.34591961352026],[4.9423233620898595,52.3461296607435],[4.942222658916824,52.34633970696878],[4.942121955743791,52.34654975219609],[4.942021252570755,52.34675979642543],[4.941920549397722,52.34696983965682],[4.941819846224687,52.347179881890256],[4.941719143051652,52.34738992312573],[4.941618439878619,52.34759996336325],[4.941517736705585,52.347810002602834],[4.941043922438413,52.34772948765666],[4.940570108171242,52.347648972563874],[4.94009629390407,52.34756845732441],[4.939622479636898,52.34748794193833],[4.939148665369727,52.34740742640559],[4.938674851102555,52.347326910726224],[4.938201036835384,52.34724639490019],[4.937727222568213,52.347165878927534],[4.937253408301041,52.347085362808215],[4.93677959403387,52.34700484654227],[4.936305779766698,52.34692433012966],[4.935831965499527,52.346843813570416],[4.935358151232355,52.34676329686453],[4.934884336965184,52.34668278001201],[4.934410522698013,52.34660226301281],[4.93393670843084,52.346521745866994],[4.933462894163669,52.346441228574534],[4.932989079896498,52.346360711135425],[4.932515265629327,52.34628019354966],[4.9320414513621555,52.34619967581726],[4.931567637094984,52.346119157938205],[4.931093822827813,52.346038639912514],[4.93062000856064,52.34595812174017],[4.930146194293469,52.345877603421194],[4.9296723800262985,52.34579708495556],[4.929198565759125,52.34571656634329],[4.928724751491955,52.34563604758435],[4.928250937224785,52.34555552867879],[4.927777122957612,52.34547500962657],[4.9273033086904405,52.34539449042771],[4.92682949442327,52.3453139710822],[4.926355680156099,52.34523345159005],[4.925881865888925,52.34515293195123],[4.925408051621755,52.34507241216579],[4.9249342373545835,52.344991892233686],[4.924460423087411,52.344911372154954],[4.923986608820241,52.34483085192956],[4.92351279455307,52.34475033155753],[4.923038980285897,52.34466981103883],[4.922565166018726,52.3445892903735],[4.922091351751555,52.344508769561514],[4.921617537484384,52.344428248602895],[4.921143723217212,52.34434772749761],[4.920669908950041,52.34426720624569],[4.9201960946828684,52.34418668484712],[4.919722280415697,52.3441061633019],[4.9192484661485265,52.344025641610024],[4.918774651881355,52.343945119771504],[4.918300837614184,52.34386459778635],[4.917827023347012,52.34378407565453],[4.917353209079841,52.34370355337606],[4.9168793948126694,52.34362303095095],[4.916405580545497,52.3435425083792],[4.915931766278326,52.34346198566079],[4.915457952011155,52.343381462795726],[4.914984137743982,52.343300939784015],[4.914510323476812,52.343220416625655],[4.914036509209641,52.343139893320654],[4.913562694942469,52.34305936986899],[4.913088880675297,52.34297884627069],[4.912615066408127,52.342898322525734],[4.912141252140955,52.34281779863413],[4.911667437873782,52.34273727459586],[4.911193623606612,52.34265675041096],[4.9112979541298705,52.3424486159332],[4.911402284653129,52.34224048047569],[4.911506615176388,52.34203234403842],[4.911610945699647,52.341824206621396],[4.911715276222906,52.34161606822461],[4.911819606746167,52.34140792884807],[4.911923937269425,52.34119978849177],[4.912028267792684,52.340991647155704],[4.912132598315944,52.34078350483988],[4.912236928839202,52.340575361544275],[4.912341259362462,52.34036721726891],[4.91244558988572,52.340159072013776],[4.912549920408978,52.339950925778865],[4.9126542509322375,52.339742778564194],[4.9127585814554955,52.33953463036974],[4.912862911978756,52.33932648119549],[4.912967242502015,52.33911833104148],[4.913071573025274,52.338910179907685],[4.913175903548533,52.3387020277941],[4.9132802340717925,52.33849387470073],[4.9133845645950505,52.338285720627574],[4.91348889511831,52.338077565574636],[4.913593225641568,52.337869409541895],[4.913697556164828,52.33766125252937],[4.913801886688087,52.337453094537054],[4.913906217211347,52.337244935564925],[4.914010547734606,52.33703677561301],[4.914114878257864,52.336828614681295],[4.914219208781122,52.33662045276978],[4.914323539304381,52.33641228987845],[4.914427869827641,52.336204126007324],[4.9145322003509,52.33599596115639],[4.914636530874159,52.335787795325636],[4.9147408613974175,52.33557962851507],[4.914845191920676,52.33537146072471],[4.914949522443937,52.33516329195452],[4.915053852967195,52.33495512220451],[4.915158183490455,52.334746951474685],[4.915262514013713,52.334538779765055],[4.9153668445369725,52.33433060707558],[4.915471175060231,52.334122433406286],[4.91557550558349,52.33391425875716],[4.915679836106749,52.33370608312822],[4.915784166630008,52.33349790651944],[4.915888497153266,52.333289728930836],[4.915992827676526,52.333081550362394],[4.916097158199785,52.33287337081411],[4.916201488723043,52.332665190286],[4.916305819246303,52.332457008778036],[4.916410149769562,52.33224882629025],[4.916514480292821,52.332040642822605],[4.91661881081608,52.331832458375125],[4.916723141339339,52.331624272947785],[4.9168274718625975,52.33141608654059],[4.916931802385856,52.33120789915356],[4.917036132909117,52.33099971078668],[4.917140463432375,52.330791521439934],[4.917244793955635,52.33058333111334],[4.917349124478894,52.33037513980689],[4.9174534550021525,52.330166947520574],[4.9175577855254105,52.3299587542544],[4.917662116048669,52.329750560008364],[4.917766446571928,52.329542364782455],[4.917870777095187,52.32933416857668],[4.94796273977978,52.33436547931902]]]}' > ./44a2797e3fc5e3cf_3b72f58c723da9c4.geojson

gdalwarp \
  -of COG -co COMPRESS=JPEG -co QUALITY=75 \
  -dstalpha -overwrite \
  -r cubic \
  -cutline ./44a2797e3fc5e3cf_3b72f58c723da9c4.geojson -crop_to_cutline -cutline_srs "EPSG:4326" \
  -s_srs 'EPSG:3857' \
  -t_srs 'EPSG:3857' \
  -ts 5176 4257 \
  -order 1 \
  ./44a2797e3fc5e3cf_3b72f58c723da9c4.vrt \
  ./44a2797e3fc5e3cf_3b72f58c723da9c4-warped.tif
if ! [ -f ./0618d3727f002bcf.jpg ]; then
  echo "Image file does not exist: ./0618d3727f002bcf.jpg"
  echo "This script expects a full-size source images for each georeferenced map it processes. See the README for more information."
  exit 1
fi

required_width_0618d3727f002bcf_bb4029969eeff948=5288
required_height_0618d3727f002bcf_bb4029969eeff948=3959

width_0618d3727f002bcf_bb4029969eeff948=( $(gdalinfo -json ./0618d3727f002bcf.jpg | jq '.size[0]') )
height_0618d3727f002bcf_bb4029969eeff948=( $(gdalinfo -json ./0618d3727f002bcf.jpg | jq '.size[1]') )

if [ "$width_0618d3727f002bcf_bb4029969eeff948" -eq "$required_width_0618d3727f002bcf_bb4029969eeff948" ] &&
   [ "$height_0618d3727f002bcf_bb4029969eeff948" -eq "$required_height_0618d3727f002bcf_bb4029969eeff948" ]; then
    echo "Found image with correct size: ./0618d3727f002bcf.jpg"
else
    echo "Error: found image with incorrect size"
    echo "  Image: ./0618d3727f002bcf.jpg"
    echo "  Expected: $required_width_0618d3727f002bcf_bb4029969eeff948 x $required_height_0618d3727f002bcf_bb4029969eeff948"
    echo "  Found: $width_0618d3727f002bcf_bb4029969eeff948 x $height_0618d3727f002bcf_bb4029969eeff948"
    exit 1
fi
gdal_translate -of vrt \
  -a_srs 'EPSG:3857' \
  -gcp 3324 3373 551263.6807525499 6863348.324617058 \
-gcp 3794 1538 551271.7514156324 6861899.42063415 \
-gcp 4463 2750 550532.990746932 6862641.834070058 \
  ./0618d3727f002bcf.jpg \
  ./0618d3727f002bcf_bb4029969eeff948.vrt

echo '{"type":"Polygon","coordinates":[[[4.975985307226838,52.339615014472194],[4.975894054788356,52.33982008172596],[4.9758028023498735,52.34002514802872],[4.97571154991139,52.340230213380515],[4.975620297472907,52.3404352777813],[4.975529045034425,52.340640341231136],[4.975437792595941,52.340845403729965],[4.975346540157458,52.34105046527782],[4.975255287718976,52.34125552587469],[4.975164035280494,52.34146058552059],[4.97507278284201,52.34166564421552],[4.974981530403528,52.34187070195947],[4.974890277965045,52.34207575875246],[4.974799025526561,52.34228081459447],[4.974707773088079,52.34248586948551],[4.9746165206495965,52.34269092342559],[4.974525268211113,52.34289597641471],[4.97443401577263,52.34310102845286],[4.974342763334148,52.34330607954005],[4.974251510895664,52.343511129676294],[4.974160258457181,52.34371617886157],[4.974069006018699,52.34392122709589],[4.973977753580217,52.344126274379256],[4.973886501141733,52.34433132071168],[4.973795248703251,52.344536366093145],[4.973703996264769,52.344741410523675],[4.973612743826284,52.344946454003235],[4.973521491387802,52.345151496531884],[4.97343023894932,52.34535653810956],[4.973338986510836,52.34556157873631],[4.973247734072354,52.345766618412114],[4.973156481633872,52.34597165713699],[4.973065229195388,52.34617669491092],[4.972973976756905,52.346381731733935],[4.972882724318423,52.346586767606],[4.9727914718799395,52.346791802527136],[4.972700219441457,52.34699683649736],[4.972608967002975,52.347201869516645],[4.972517714564491,52.347406901584996],[4.972426462126008,52.347611932702435],[4.972335209687525,52.34781696286896],[4.972243957249043,52.348021992084554],[4.97215270481056,52.34822702034924],[4.972061452372077,52.348432047663],[4.971970199933595,52.34863707402585],[4.971878947495111,52.34884209943779],[4.971787695056628,52.34904712389882],[4.971696442618146,52.34925214740894],[4.9716051901796625,52.34945716996815],[4.97151393774118,52.34966219157646],[4.971422685302698,52.349867212233875],[4.971331432864214,52.35007223194037],[4.971240180425732,52.350277250695974],[4.971148927987247,52.350482268500684],[4.971057675548765,52.350687285354496],[4.9709664231102835,52.3508923012574],[4.970875170671799,52.35109731620943],[4.970783918233317,52.35130233021055],[4.970692665794835,52.351507343260806],[4.97060141335635,52.35171235536015],[4.970510160917868,52.35191736650864],[4.970418908479386,52.35212237670621],[4.9703276560409035,52.352327385952925],[4.97023640360242,52.35253239424875],[4.970145151163938,52.3527374015937],[4.969703467202957,52.35265542295274],[4.9692617832419765,52.352573444159745],[4.968820099280995,52.35249146521469],[4.968378415320014,52.35240948611759],[4.967936731359034,52.352327506868434],[4.967495047398054,52.352245527467225],[4.967053363437074,52.35216354791397],[4.966611679476093,52.35208156820867],[4.966169995515112,52.3519995883513],[4.965728311554131,52.35191760834189],[4.965286627593151,52.35183562818043],[4.96484494363217,52.351753647866914],[4.9644032596711885,52.351671667401355],[4.96396157571021,52.35158968678373],[4.963519891749228,52.35150770601406],[4.963078207788247,52.35142572509234],[4.962636523827268,52.351343744018564],[4.962194839866286,52.35126176279273],[4.961753155905305,52.35117978141485],[4.961311471944325,52.351097799884926],[4.960869787983344,52.35101581820294],[4.960428104022364,52.3509338363689],[4.959986420061384,52.35085185438281],[4.959544736100403,52.350769872244676],[4.959103052139422,52.35068788995448],[4.958661368178441,52.35060590751222],[4.958219684217461,52.350523924917916],[4.9577780002564795,52.35044194217156],[4.957336316295499,52.350359959273156],[4.95689463233452,52.350277976222685],[4.956452948373539,52.35019599302017],[4.956011264412559,52.35011400966558],[4.955569580451577,52.35003202615896],[4.9551278964905965,52.34995004250027],[4.954686212529616,52.34986805868954],[4.954244528568635,52.34978607472676],[4.9538028446076545,52.3497040906119],[4.953361160646674,52.34962210634501],[4.952919476685693,52.349540121926054],[4.9524777927247134,52.349458137355036],[4.952036108763733,52.349376152631976],[4.951594424802752,52.34929416775686],[4.9511527408417715,52.34921218272968],[4.95071105688079,52.34913019755046],[4.950269372919809,52.34904821221917],[4.9498276889588295,52.348966226735826],[4.949386004997849,52.348884241100414],[4.948944321036869,52.34880225531297],[4.948502637075887,52.34872026937346],[4.948060953114906,52.3486382832819],[4.947619269153926,52.34855629703827],[4.947177585192946,52.3484743106426],[4.946735901231965,52.34839232409485],[4.946294217270983,52.34831033739506],[4.945852533310004,52.348228350543216],[4.945410849349023,52.34814636353932],[4.944969165388042,52.348064376383356],[4.9445274814270626,52.34798238907534],[4.944085797466081,52.34790040161526],[4.9436441135050995,52.34781841400313],[4.94320242954412,52.34773642623894],[4.942760745583139,52.34765443832269],[4.942319061622159,52.34757245025438],[4.941877377661179,52.34749046203401],[4.94196386218881,52.34728803668691],[4.94205034671644,52.34708561041291],[4.942136831244071,52.346883183212],[4.942223315771702,52.346680755084186],[4.942309800299334,52.34647832602946],[4.942396284826964,52.34627589604783],[4.942482769354596,52.3460734651393],[4.942569253882228,52.34587103330384],[4.942655738409857,52.34566860054148],[4.94274222293749,52.34546616685219],[4.942828707465121,52.345263732236],[4.942915191992752,52.34506129669288],[4.9430016765203835,52.34485886022285],[4.9430881610480135,52.344656422825885],[4.9431746455756445,52.34445398450201],[4.943261130103277,52.3442515452512],[4.943347614630907,52.34404910507346],[4.943434099158538,52.3438466639688],[4.94352058368617,52.3436442219372],[4.943607068213801,52.343441778978665],[4.943693552741432,52.3432393350932],[4.943780037269063,52.34303689028081],[4.943866521796694,52.342834444541474],[4.9439530063243255,52.3426319978752],[4.9440394908519565,52.342429550281985],[4.944125975379587,52.34222710176182],[4.9442124599072175,52.34202465231472],[4.94429894443485,52.341822201940666],[4.944385428962482,52.341619750639666],[4.944471913490111,52.34141729841172],[4.944558398017744,52.34121484525683],[4.944644882545375,52.34101239117497],[4.944731367073005,52.34080993616617],[4.944817851600638,52.34060748023041],[4.944904336128267,52.34040502336768],[4.944990820655899,52.340202565578],[4.94507730518353,52.34000010686135],[4.945163789711161,52.33979764721774],[4.945250274238792,52.33959518664718],[4.945336758766424,52.33939272514964],[4.945423243294055,52.33919026272513],[4.945509727821685,52.338987799373655],[4.945596212349317,52.33878533509521],[4.945682696876948,52.338582869889784],[4.945769181404579,52.33838040375738],[4.945855665932211,52.338177936698],[4.9459421504598415,52.337975468711655],[4.946028634987473,52.33777299979832],[4.946115119515104,52.337570529958],[4.946201604042735,52.337368059190695],[4.946288088570365,52.33716558749641],[4.946374573097997,52.33696311487514],[4.946461057625629,52.336760641326876],[4.946547542153259,52.33655816685162],[4.946634026680892,52.33635569144938],[4.946720511208523,52.336153215120135],[4.946806995736153,52.3359507378639],[4.9468934802637845,52.335748259680656],[4.9469799647914146,52.33554578057042],[4.947066449319046,52.33534330053318],[4.947152933846678,52.33514081956894],[4.947239418374308,52.3349383376777],[4.947325902901939,52.33473585485946],[4.94741238742957,52.33453337111419],[4.975985307226838,52.339615014472194]]]}' > ./0618d3727f002bcf_bb4029969eeff948.geojson

gdalwarp \
  -of COG -co COMPRESS=JPEG -co QUALITY=75 \
  -dstalpha -overwrite \
  -r cubic \
  -cutline ./0618d3727f002bcf_bb4029969eeff948.geojson -crop_to_cutline -cutline_srs "EPSG:4326" \
  -s_srs 'EPSG:3857' \
  -t_srs 'EPSG:3857' \
  -ts 4933 4310 \
  -order 1 \
  ./0618d3727f002bcf_bb4029969eeff948.vrt \
  ./0618d3727f002bcf_bb4029969eeff948-warped.tif

gdalbuildvrt ./merged.vrt \
  ./bc5d7040bad8e28b_5cf13f6681d355e3-warped.tif ./b001de2950590a8d_83d44a0b956681b0-warped.tif ./44a2797e3fc5e3cf_3b72f58c723da9c4-warped.tif ./0618d3727f002bcf_bb4029969eeff948-warped.tif
