# @allmaps/id

Uses the [SHA-1](https://en.wikipedia.org/wiki/SHA-1) algorithm to generate IDs from strings, random IDs from UUIDs and checksums from JSON objects.

Allmaps uses this module to create IDs from IIIF URIs. For example:

*   Given the following manifest URL: https://digital.zlb.de/viewer/api/v1/records/34231682/manifest/,
*   The output of the [`generateId`](#generateid) function will be: `6f5a7b547c8f6fbe`,
*   We can use this ID to lookup the [Georeference Annotation](https://iiif.io/api/extension/georef/) for the georeferenced maps in this manifest using Allmaps API:
    https://annotations.allmaps.org/manifests/6f5a7b547c8f6fbe.

To see @allmaps/id in action, view this [Observable notebook](https://observablehq.com/@allmaps/the-allmaps-id-module).

## Usage

This is an ESM-only module that works in browsers and Node.js.

Node.js:

The Node.js version of @allmaps/id uses[`crypto.createHash()`](https://nodejs.org/api/crypto.html#cryptocreatehashalgorithm-options) and [`crypto.randomUUID()`](https://nodejs.org/api/crypto.html#cryptorandomuuidoptions) from the [`crypto` module](https://nodejs.org/api/crypto.html). First, run `npm install @allmaps/id`.

```js
import { generateId } from '@allmaps/id'
const url = 'https://digital.zlb.de/viewer/api/v1/records/34231682/manifest/'
const id = await generateId(url)
// id = '6f5a7b547c8f6fbe'
```

Browser:

The browser version of @allmaps/id uses the [`SubtleCrypto.digest()`](https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest) and [`Crypto.randomUUID()`](https://developer.mozilla.org/en-US/docs/Web/API/Crypto/randomUUID) Web APIs.

```html
<script type="module">
  import { generateId } from 'https://unpkg.com/@allmaps/id?module'

  const url =
    'https://orka.bibliothek.uni-kassel.de/viewer/rest/iiif/manifests/1535113582549/manifest/'
  const id = await generateId(url)
  console.log(id)
</script>
```

## CLI

Generating Allmaps IDs is also possible using the [Allmaps CLI](https://github.com/allmaps/allmaps/tree/main/apps/cli).

For example:

```sh
echo https://digital.zlb.de/viewer/api/v1/records/34231682/manifest/ | allmaps id
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

*   [generateHash](#generatehash)
    *   [Parameters](#parameters)
*   [generateId](#generateid)
    *   [Parameters](#parameters-1)
*   [generateRandomId](#generaterandomid)
    *   [Parameters](#parameters-2)
*   [generateChecksum](#generatechecksum)
    *   [Parameters](#parameters-3)

### generateHash

Computes SHA-1 hash of input string.

#### Parameters

*   `str` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Input string.

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** SHA-1 hash of `str`.

### generateId

Generates an ID from a string using the SHA-1 algorithm. Given the same input, the ID will always be the same.

#### Parameters

*   `str` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Input string.
*   `length` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Length of returned hash.  The maximum length of the hash is 40 characters. (optional, default `16`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** First `length` characters of the SHA-1 hash of `str`.

### generateRandomId

Generates a random ID.

#### Parameters

*   `length` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Length of returned hash. The maximum length of the hash is 40 characters. (optional, default `16`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** First `length` characters of the SHA-1 hash of a random UUID.

### generateChecksum

Generates a checksum of a JSON object.

#### Parameters

*   `obj` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON object.
*   `length` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Length of returned hash. The maximum length of the hash is 40 characters. (optional, default `16`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** First `length` characters of the SHA-1 hash of sorted and serialized version of `obj`.
