# @allmaps/render

Plugin that renders georeferenced maps in a warped fashion on an HTML canvas element.

Currently, only rendering using the WebGL2 API is implemented. In the future, rendering using the Canvas API might be implemented as well.

For practical implementations in webmapping libraries, see the [@allmaps/openlayers](../openlayers/), [@allmaps/leaflet](../leaflet/) anc [@allmaps/maplibre](../maplibre/) packages.

## How it works

A renderer accomplishes this task using a set of properties it is assigned at it's creation:

*   A **WebGL2RenderingContext** containing the rendering context for the drawing surface of an HTML element.
*   A **WebGLProgram** for storing the vertex and fragment shader
*   A **WarpedMapList** containing the list of WarpedMaps to draw
*   A list of **WebGL2WarpedMap** elements containing the GL information for each warped map
*   A **tileCache** for storing the image bitmaps of cached tiles

This package also contains two other important classes:

*   A **Viewport** describes which view of the map should be rendered (extent, zoom level, ...)
*   A **WarpedMap** describes how a georeferenced map is warped using a specific transformation

The renderer draws in it's WebGL2RenderingContext when it's `render()` function is called and passed a Viewport (e.g. by a JS mapping library). Then, for each WarpedMap is the WarpedMapList, the following happens:

*   The Ground Control Points are read from the Georeference Annotation, and using those a warping transformation is computed from IIIF resource pixels to projected geo coordinates.
*   The resource mask is read from the Georeference Annotation, and the area within is divided into small triangles.
*   The best tile zoom level is computed for the current viewport, telling us which IIIF tile level to use.
*   The Viewport is transformed (warped) backwards from projected geo coordinates to the resource image. The IIIF tiles covering this 'viewport on the resource image' are fetched and cached in the TileCache.
*   The area inside the Resource Mask is rendered in the viewport, triangle by triangle, using the cached tiles. The location of the triangles is computed using the forward transformation built from the Ground Control Points.

## Installation

This package works in browsers and in Node.js as an ESM module.

Install with npm:

```sh
npm install @allmaps/render
```

And load using:

```js
import { Viewport, WebGL2Renderer } from '@allmaps/render'
```

You can build this package using

```sh
pnpm run build
```

## Usage

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

*   [WarpedMapWithImageInfo](#warpedmapwithimageinfo)
*   [WarpedMapList](#warpedmaplist)
    *   [getMaps](#getmaps)
    *   [getWarpedMap](#getwarpedmap)
    *   [getMapZIndex](#getmapzindex)
    *   [getTotalBbox](#gettotalbbox)
    *   [getTotalProjectedGeoMaskBbox](#gettotalprojectedgeomaskbbox)
    *   [getMapsByGeoBbox](#getmapsbygeobbox)
    *   [setImageInfoCache](#setimageinfocache)
    *   [setMapResourceMask](#setmapresourcemask)
    *   [setMapsTransformationType](#setmapstransformationtype)
    *   [bringMapsToFront](#bringmapstofront)
    *   [sendMapsToBack](#sendmapstoback)
    *   [bringMapsForward](#bringmapsforward)
    *   [sendMapsBackward](#sendmapsbackward)
    *   [showMaps](#showmaps)
    *   [hideMaps](#hidemaps)
    *   [addGeoreferencedMap](#addgeoreferencedmap)
    *   [removeGeoreferencedMap](#removegeoreferencedmap)
    *   [addGeoreferenceAnnotation](#addgeoreferenceannotation)
    *   [removeGeoreferenceAnnotation](#removegeoreferenceannotation)
*   [Viewport](#viewport)
    *   [Properties](#properties)
    *   [computeProjectedGeoRectangle](#computeprojectedgeorectangle)
*   [TileCache](#tilecache)
    *   [getCacheableTile](#getcacheabletile)
    *   [getCachedTile](#getcachedtile)
    *   [getCacheableTiles](#getcacheabletiles)
    *   [getCachedTiles](#getcachedtiles)
    *   [getTileUrls](#gettileurls)
    *   [requestFetcableMapTiles](#requestfetcablemaptiles)
*   [CacheableTile](#cacheabletile)
    *   [fetch](#fetch)
    *   [isCachedTile](#iscachedtile)
    *   [abort](#abort)
*   [CachedTile](#cachedtile)
*   [FetchableMapTile](#fetchablemaptile)
*   [WebGL2Renderer](#webgl2renderer)
    *   [getOpacity](#getopacity)
    *   [setOpacity](#setopacity)
    *   [resetOpacity](#resetopacity)
    *   [getMapOpacity](#getmapopacity)
    *   [setMapOpacity](#setmapopacity)
    *   [resetMapOpacity](#resetmapopacity)
    *   [getRemoveColorOptions](#getremovecoloroptions)
    *   [setRemoveColorOptions](#setremovecoloroptions)
    *   [resetRemoveColorOptions](#resetremovecoloroptions)
    *   [getMapRemoveColorOptions](#getmapremovecoloroptions)
    *   [setMapRemoveColorOptions](#setmapremovecoloroptions)
    *   [resetMapRemoveColorOptions](#resetmapremovecoloroptions)
    *   [getColorizeOptions](#getcolorizeoptions)
    *   [setColorizeOptions](#setcolorizeoptions)
    *   [resetColorizeOptions](#resetcolorizeoptions)
    *   [getMapColorizeOptions](#getmapcolorizeoptions)
    *   [setMapColorizeOptions](#setmapcolorizeoptions)
    *   [resetMapColorizeOptions](#resetmapcolorizeoptions)
    *   [getSaturation](#getsaturation)
    *   [setSaturation](#setsaturation)
    *   [resetSaturation](#resetsaturation)
    *   [getMapSaturation](#getmapsaturation)
    *   [setMapSaturation](#setmapsaturation)
    *   [resetMapSaturation](#resetmapsaturation)
    *   [render](#render)
*   [WebGL2WarpedMap](#webgl2warpedmap)
    *   [updateVertexBuffers](#updatevertexbuffers)
    *   [addCachedTileAndUpdateTextures](#addcachedtileandupdatetextures)
    *   [removeCachedTileAndUpdateTextures](#removecachedtileandupdatetextures)
*   [DEFAULT\_SCALE\_FACTOR\_SHARPENING](#default_scale_factor_sharpening)
*   [getBestTileZoomLevelForScale](#getbesttilezoomlevelforscale)
    *   [Parameters](#parameters-40)

### WarpedMapWithImageInfo

**Extends WarpedMap**

Class for warped maps with image ID and parsed IIIF image.

Type: [WarpedMapWithImageInfo](#warpedmapwithimageinfo)

### WarpedMapList

**Extends EventTarget**

Class for warped map lists, which describe an ordered array of maps to be drawn.
They contain an imageInfoCash, and and RTree for quickly looking up maps using their Bbox.

Type: [WarpedMapList](#warpedmaplist)

#### getMaps

Returns mapIds for the maps in this list.

Returns **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### getWarpedMap

Returns the WarpedMap object in this list of map specified by a mapId.

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**&#x20;

Returns **(WarpedMap | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getMapZIndex

Returns the zIndex of a map.

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**&#x20;

Returns **([number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getTotalBbox

Return the total Bbox of all visible maps in this list, in geo coordinates

Returns **(Bbox | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getTotalProjectedGeoMaskBbox

Return the total Bbox of all visible maps in this list, in projectedGeo coordinates

Returns **(Bbox | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getMapsByGeoBbox

Returns mapId's of the maps whose geoBbox overlaps with the specified geoBbox.

##### Parameters

*   `geoBbox` **Bbox**&#x20;

Returns **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### setImageInfoCache

Sets the image info cache

##### Parameters

*   `cache` **Cache** the image info cache

#### setMapResourceMask

Sets the resource mask for a specified map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map
*   `resourceMask` **Ring** the new resource mask

#### setMapsTransformationType

Sets the transformation type of specified maps

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** the IDs of the maps
*   `transformationType` **TransformationType** the new transformation type

#### bringMapsToFront

Changes the zIndex of the specified maps to bring them to front

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### sendMapsToBack

Changes the zIndex of the specified maps to send them to back

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### bringMapsForward

Changes the zIndex of the specified maps to bring them forward

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### sendMapsBackward

Changes the zIndex of the specified maps to send them backward

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### showMaps

Changes the visibility of the specified maps to `true`

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### hideMaps

Changes the visibility of the specified maps to `false`

##### Parameters

*   `mapIds` **Iterable<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### addGeoreferencedMap

Adds a georeferenced map to this list

##### Parameters

*   `georeferencedMap` **unknown**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Error](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error))>**&#x20;

#### removeGeoreferencedMap

Removes a georeferenced map from this list

##### Parameters

*   `georeferencedMap` **unknown**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Error](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error))>**&#x20;

#### addGeoreferenceAnnotation

Parses an annotation and adds its georeferenced map to this list

##### Parameters

*   `annotation` **unknown**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Error](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error))>>**&#x20;

#### removeGeoreferenceAnnotation

Parses an annotation and removes its georeferenced map from this list

##### Parameters

*   `annotation` **unknown**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Error](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error))>>**&#x20;

### Viewport

**Extends EventTarget**

The viewport describes the view on the rendered map.

Type: [Viewport](#viewport)

#### Properties

*   `geoCenter` **Point** Center point of the viewport, in lon lat geo coordinates.
*   `geoRectangle` **Rectangle** Rotated rectangle (possibly quadrilateral) of the viewport point, in lon lat geo coordinates.
*   `geoSize` **Size** Size of the viewport in lon lat geo coordinates, as \[width, height]. (This is the size of the bbox of the rectangle, since lon lat only makes sense in in that case).
*   `geoBbox` **Bbox** Bbox of the rotated rectangle of the viewport, in lon lat geo coordinates.
*   `projectedGeoCenter` **Point** Center point of the viewport, in projected geo coordinates.
*   `projectedGeoRectangle` **Rectangle** Rotated rectangle of the viewport point, in projected geo coordinates.
*   `projectedGeoSize` **Size** Size of the viewport in projected geo coordinates, as \[width, height]. (This is not the size of the bbox of the rotated rectangle, but the width and hight of the rectangle).
*   `projectedGeoBbox` **Bbox** Bbox of the rotated rectangle of the viewport, in projected geo coordinates.
*   `rotation` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Rotation of the viewport with respect to the projected coordinate system.
*   `projectedGeoPerViewportScale` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Resolution of the viewport, in projected geo coordinates per viewport pixel.
*   `viewportCenter` **Point** Center point of the viewport, in viewport pixels.
*   `viewportRectangle` **Rectangle** Rectangle of the viewport point, in viewport pixels.
*   `viewportSize` **Size** Size of the viewport in viewport pixels, as \[width, height].
*   `viewportBbox` **Bbox** Bbox of the viewport, in viewport pixels.
*   `devicePixelRatio` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The devicePixelRatio of the viewport.
*   `canvasCenter` **Point** Center point of the HTMLCanvasElement of the viewport, in canvas pixels.
*   `canvasRectangle` **Rectangle** Rectangle of the HTMLCanvasElement of the viewport, in canvas pixels.
*   `canvasSize` **Size** Size of the HTMLCanvasElement of the viewport in canvas pixels (viewportSize\*devicePixelRatio), as \[width, height].
*   `canvasBbox` **Bbox** Bbox of the HTMLCanvasElement of the viewport, in canvas pixels.
*   `projectedGeoPerCanvasScale` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Scale of the viewport, in projected geo coordinates per canvas pixel (resolution/devicePixelRatio).
*   `projectedGeoToViewportTransform` **Transform** Transform from projected geo coordinates to viewport pixels. Equivalent to OpenLayer coordinateToPixelTransform.
*   `projectedGeoToClipTransform` **Transform** Transform from projected geo coordinates to webgl2 coordinates in the \[-1, 1] range. Equivalent to OpenLayer projectionTransform.

#### computeProjectedGeoRectangle

Returns a rotated rectangle in projected geo coordinates

##### Parameters

*   `projectedGeoCenter` &#x20;
*   `projectedGeoPerViewportScale` &#x20;
*   `rotation` &#x20;
*   `viewportSize` &#x20;

### TileCache

**Extends EventTarget**

A class for caches of tiles.

Type: [TileCache](#tilecache)

#### getCacheableTile

Get a specific cacheable tile in this cache
I.e. independent of whether their fetching is completed and image bitmap is created

##### Parameters

*   `tileUrl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the url of the requested tile

Returns **([CacheableTile](#cacheabletile) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getCachedTile

Get a specific cached tile in this cache
I.e. with their fetching completed and image bitmap created

##### Parameters

*   `tileUrl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the url of the requested tile

Returns **([CachedTile](#cachedtile) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### getCacheableTiles

Get the tiles in this cache (independent of whether their caching has completed)

Returns **IterableIterator<[CacheableTile](#cacheabletile)>**&#x20;

#### getCachedTiles

Get the tiles in this cache whose caching has completed
I.e. their fetching is completed and image bitmap is created

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[CacheableTile](#cacheabletile)>**&#x20;

#### getTileUrls

Get the urls of all tiles in this cache

Returns **IterableIterator<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>**&#x20;

#### requestFetcableMapTiles

Process the request for new tiles to be added to this cache

##### Parameters

*   `requestedTiles` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[FetchableMapTile](#fetchablemaptile)>**&#x20;

### CacheableTile

**Extends EventTarget**

Class for tiles that can be cached. These are used on the tile cache (and are not associated to a specific map)

Type: [CacheableTile](#cacheabletile)

#### fetch

Fetch the tile and create it's image bitmap.

Returns and event when completed (or error).

Returns **([Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)\<ImageBitmap> | void)**&#x20;

#### isCachedTile

Whether a tile has completed it's caching
I.e. their fetching is completed and image bitmap is created

#### abort

Abort the fetch

### CachedTile

**Extends CacheableTile**

Class for cacheable tiles whose caching has been completed
I.e. their fetching is completed and image bitmap is created

Type: [CachedTile](#cachedtile)

### FetchableMapTile

Class for tiles associated to a warped map. These are used to describe the tiles requested by the renderer.

Type: [FetchableMapTile](#fetchablemaptile)

### WebGL2Renderer

**Extends EventTarget**

Class for renderers that render warped maps to a HTML canvas element using WebGL2

It's main function is `render()`

Type: [WebGL2Renderer](#webgl2renderer)

#### getOpacity

Get the opacity of the renderer

Returns **([number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setOpacity

Set the opacity of the renderer

##### Parameters

*   `opacity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** opacity to set

#### resetOpacity

Reset the opacity of the renderer

#### getMapOpacity

Get the opacity of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

Returns **([number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setMapOpacity

Set the opacity of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map
*   `opacity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** opacity to set

#### resetMapOpacity

Rreset the opacity of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

#### getRemoveColorOptions

Get the 'remove color options' of the renderer

Returns **(Partial\<RemoveColorOptions> | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setRemoveColorOptions

Set the 'remove color options' of the renderer

##### Parameters

*   `removeColorOptions` **RemoveColorOptions**&#x20;

#### resetRemoveColorOptions

Reset the 'remove color options' of the renderer

#### getMapRemoveColorOptions

Get the 'remove color options' of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

Returns **(Partial\<RemoveColorOptions> | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setMapRemoveColorOptions

Set the 'remove color options' of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map
*   `removeColorOptions` **RemoveColorOptions** the 'remove color options' to set

#### resetMapRemoveColorOptions

Reset the 'remove color options' of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

#### getColorizeOptions

Get the colorize options of the renderer

Returns **(Partial\<ColorizeOptions> | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setColorizeOptions

Set the colorize options of the renderer

##### Parameters

*   `colorizeOptions` **ColorizeOptions** the colorize options to set

#### resetColorizeOptions

Reset the colorize options of the renderer

#### getMapColorizeOptions

Get the colorize options of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

Returns **(Partial\<ColorizeOptions> | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setMapColorizeOptions

Set the colorize options of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map
*   `colorizeOptions` **ColorizeOptions** the colorize options to set

#### resetMapColorizeOptions

Reset the colorize options of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

#### getSaturation

Get the saturation of the renderer

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**&#x20;

#### setSaturation

Set the saturation of the renderer

0 - grayscale, 1 - original colors

##### Parameters

*   `saturation`  the satuation to set

#### resetSaturation

Reset the satuation of the renderer

#### getMapSaturation

Get the saturation of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

Returns **([number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) | [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))**&#x20;

#### setMapSaturation

Set the saturation of a map

0 - grayscale, 1 - original colors

##### Parameters

*   `mapId`  ID of the map
*   `saturation`  the saturation to set

#### resetMapSaturation

reset the saturation of a map

##### Parameters

*   `mapId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of the map

#### render

Render the map for a given viewport

##### Parameters

*   `viewport` **[Viewport](#viewport)** the current viewport

### WebGL2WarpedMap

**Extends EventTarget**

Class for storing the WebGL2 information necessary to draw WarpedMaps

Type: [WebGL2WarpedMap](#webgl2warpedmap)

#### updateVertexBuffers

Update the vertex buffers of this warped map

##### Parameters

*   `projectedGeoToClipTransform` **Transform** Transform from projected geo coordinates to webgl2 coordinates in the \[-1, 1] range. Equivalent to OpenLayer projectionTransform.

#### addCachedTileAndUpdateTextures

Add cached tile to the textures of this map and update textures

##### Parameters

*   `cachedTile` **[CachedTile](#cachedtile)**&#x20;

#### removeCachedTileAndUpdateTextures

Remove cached tile from the textures of this map and update textes

##### Parameters

*   `tileUrl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**&#x20;

### DEFAULT\_SCALE\_FACTOR\_SHARPENING

Scale factor sharpening: 1 = no sharpening, 2 = one level extra sharper, 4 = two levels extra sharper, 1/2 = one level less sharp ...

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

### getBestTileZoomLevelForScale

Returns the best TileZoomLevel for a given resource-to-canvas scale.

#### Parameters

*   `image` **[Image](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/Image)** A parsed IIIF Image
*   `resourceToCanvasScale` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The resource to canvas scale, relating resource pixels to canvas pixels.
*   `scaleFactorSharpening`   (optional, default `DEFAULT_SCALE_FACTOR_SHARPENING`)

Returns **TileZoomLevel**&#x20;
